require 'rake/clean'

task :default => [:generate, :expand,  :webize, :clean]

YML_SRC = FileList['src/*.yml']
YML_OUT = YML_SRC.ext('.ham')

HAM_SRC = FileList['src/*.ham', 'src/*.yml']
HAM_OUT = HAM_SRC.ext('.html')
CLEAN.include('src/*.html')
CLEAN.include('src/*.ham')

desc "Generate indices"
task :generate => [] do |t|
  sh "ruby lib/index.rb"
end

desc "Expand YML descriptors into Haml markup"
task :expand => YML_OUT

desc "Expand Haml markup into HTML"
task :webize => HAM_OUT

rule '.ham' => ['.yml'] do |t|
  sh "mustache #{t.source} src/practice.tmpl > #{t.name}"
end

rule '.html' => ['.ham'] do |t|
  sh "haml -r src/helpers.rb #{t.source} > #{t.name}"
  sh "cp #{t.name} site"
end
